#!/bin/bash
#IZIN SCRIPT
MYIP=$(curl -sS ipv4.icanhazip.com)
echo -e "\e[32mloading...\e[0m"
clear
IP=$(curl -s ipv4.icanhazip.com)
HOST="$(cat /etc/xray/domain)"
DATEVPS=$(date +"%d-%B-%Y")
ISPVPS=$(cat /etc/xray/isp)
CITY=$(cat /etc/xray/city)
CHATID=$(grep -E "^#bot# " "/etc/bot/.bot.db" | cut -d ' ' -f 3)
KEY=$(grep -E "^#bot# " "/etc/bot/.bot.db" | cut -d ' ' -f 2)
TIME="1"
URL="https://api.telegram.org/bot$KEY/sendMessage"
URL2="https://api.telegram.org/bot$KEY/sendDocumen"
# Valid Script
ipsaya=$(wget -qO- ipinfo.io/ip)
data_server=$(curl -v --insecure --silent https://google.com/ 2>&1 | grep Date | sed -e 's/< Date: //')
date_list=$(date +"%Y-%m-%d" -d "$data_server")
data_ip="https://raw.githubusercontent.com/bowowiwendi/ipvps/main/ip"
checking_sc() {
  useexp=$(wget -qO- $data_ip | grep $ipsaya | awk '{print $3}')
  if [[ $date_list < $useexp ]]; then
    echo -ne
  else
    echo -e "\033[1;93m────────────────────────────────────────────\033[0m"
    echo -e "\033[42m          404 NOT FOUND AUTOSCRIPT          \033[0m"
    echo -e "\033[1;93m────────────────────────────────────────────\033[0m"
    echo -e ""
    echo -e "            ${RED}PERMISSION DENIED !${NC}"
    echo -e "   \033[0;33mYour VPS${NC} $ipsaya \033[0;33mHas been Banned${NC}"
    echo -e "     \033[0;33mBuy access permissions for scripts${NC}"
    echo -e "             \033[0;33mContact Admin :${NC}"
    echo -e "      \033[0;36mTelegram${NC} t.me/WendiVpn"
    echo -e "      ${GREEN}WhatsApp${NC} wa.me/6283153170199"
    echo -e "\033[1;93m────────────────────────────────────────────\033[0m"
    exit
  fi
}
checking_sc
clear 
# // restore
function restore(){
# Color
RED='\033[0;31m'
NC='\033[0m'
GREEN='\033[0;32m'
ORANGE='\033[0;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
LIGHT='\033[0;37m'
clear
# ==========================================
# Getting
clear
echo -e "\033[1;93m┌──────────────────────────────────────────┐\033[0m"
echo -e "\033[1;93m│$NC      INPUT LINK BACKUP VPS       $NC"|lolcat
echo -e "\033[1;93m└──────────────────────────────────────────┘\033[0m"
echo -e ""
read -p "input Link backup :  " -e url
echo -e ""
wget -O backup.zip "$url"
unzip backup.zip
rm -f backup.zip
echo "Start Restore"
cd /root/backup
cp  passwd /etc/
cp  group /etc/
cp  shadow /etc/
cp  gshadow /etc/
cp  crontab /etc/
cp .ssh.db /etc/ssh/
cp .vmess.db /etc/vmess/
cp .vless.db /etc/vless/
cp .trojan.db /etc/trojan/
cp .shadowsocks.db /etc/shadowsocks/
cp -r bot /etc/
cp -r kyt /var/lib/
cp -r xray /etc/
cp -r html /var/www/
cp -r limit /etc/kyt/
cp -r vmess /etc/
cp -r trojan /etc/
cp -r vless /etc/
cp -r shadowsocks /etc/

# Cari file
if [ -f "var.txt" ]; then
  echo "File var.txt ditemukan."
  
  # Tanya pengguna apakah ingin melakukan tindakan
  read -p "Apakah Anda ingin install bot panel? (y/n): " RESPONSE
  
  if [[ "$RESPONSE" =~ ^[Yy]$ ]]; then
    # Lakukan tindakan di sini
    echo "Install bot panel..."
    # Contoh tindakan: menampilkan isi file
  mkdir -p /usr/bin/kyt
  cp var.txt /usr/bin/kyt
  rm -rf /root/backup
  apt update && apt upgrade
  apt install python3 python3-pip git
  cd /usr/bin
  wget https://raw.githubusercontent.com/bowowiwendi/WendyVpn/ABSTRAK/bot/bot.zip
  unzip bot.zip
  mv bot/* /usr/bin
  chmod +x /usr/bin/*
  rm -rf bot.zip
  clear
  wget https://raw.githubusercontent.com/bowowiwendi/WendyVpn/ABSTRAK/bot/kyt.zip
  unzip kyt.zip
  pip3 install -r kyt/requirements.txt
  apt install python3-telethon
  rm -rf kyt.zip
cat > /etc/systemd/system/kyt.service << END
[Unit]
Description=Simple kyt - @kyt
After=network.target

[Service] 
WorkingDirectory=/usr/bin
ExecStart=/usr/bin/python3 -m kyt
Restart=always

[Install]
WantedBy=multi-user.target
END
  
  systemctl start kyt 
  systemctl enable kyt
  systemctl restart kyt
  fi
fi
notif_restore
rm -f backup.zip
echo ""
read -p "Selesai Restore press !! [ ENTER ] To Menu"
menu
}
function notif_restore(){
CHATID="$CHATID"
KEY="$KEY"
TIME="$TIME"
URL="$URL"
TEXT="
◇━━━━━━━━━━━━━━━━━━━━━━━━◇
   ⚠️ RESTORE NOTIF ⚠️
     Detail Restore VPS
◇━━━━━━━━━━━━━━━━━━━━━━━━◇
     Restore Vps Done
◇━━━━━━━━━━━━━━━━━━━━━━━━◇
  BY BOT : @WendiVpn Tunnel
"

curl -s --max-time $TIME -d "chat_id=$CHATID&disable_web_page_preview=1&text=$TEXT&parse_mode=html" $URL >/dev/null
}


grenbo="\e[92;1m"
NC='\033[0m'
clear
echo -e "\033[1;93m┌──────────────────────────────────────────┐\033[0m"
echo -e "\033[1;93m│$NC          MENU MANAGER BACKUP          $NC"|lolcat
echo -e "\033[1;93m└──────────────────────────────────────────┘\033[0m"
echo -e "\033[1;93m┌──────────────────────────────────────────┐\033[0m"
echo -e "\033[1;93m│  ${grenbo}1.${NC} \033[0;36mBACKUP VPS DATA ${NC}"
echo -e "\033[1;93m│  ${grenbo}2.${NC} \033[0;36mAUTO BACKUP VPS DATA TELEGRAM${NC}"
echo -e "\033[1;93m│  ${grenbo}3.${NC} \033[0;36mAUTO BACKUP VPS DATA EMAIL${NC}"
echo -e "\033[1;93m│  ${grenbo}4.${NC} \033[0;36mRESTORE VPS DATA  ${NC}"
echo -e "\033[1;93m│  ${grenbo}x.${NC} \033[0;36mComeBack${NC}"
echo -e "\033[1;93m└──────────────────────────────────────────┘\033[0m"
echo -e ""
read -p " Select options >>>   "  opt
echo -e   ""
case $opt in
01 | 1) clear ; bot-backup ;;
02 | 2) clear ; auto-backup.sh ;;
03 | 3) clear ; autobackup_email.sh ;;
04 | 4) clear ; restore ;;
00 | 0) clear ; menu ;;
*) clear ; menu ;;
esac
